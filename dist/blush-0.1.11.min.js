!function(t){"use strict";function e(t,e){var i,s=e[t],n=[];if("."===t?(s=e,i=!1):(n=t.split("."),i=!!(n.length-1)),i){var r,a=n.length,o=e;for(r=0;r<a;r++)o&&(o=o[n[r]]);s=o}return s||0===s||(s=""),s}var i={render:function(t,e,i){var s=this.compile(t);return s.render(e,i)},compile:function(t){var e=this.cache[t];return e||(e=new i.Scanner(t),this.cache[t]=e),e.compile(),e},delimiters:["{{","}}","}}}"],cache:{}};i.Scanner=function(t){this.template=t,this.disassemblies=[new i.Disassembly],this.cursor=0,this.delimiterIndex=0,this.compiled=!1,this.outOfRange=this.template.length+1},i.Scanner.prototype.compile=function(){if(!this.compiled){for(var t=this.outOfRange-1;this.cursor<t;)this.processToken();this.compiled=!0}},i.Scanner.prototype.processToken=function(){var t=this.template.slice(this.cursor),e=t.indexOf(i.delimiters[this.delimiterIndex]);this.extractNextToken(t,e),this.addToken(),this.advanceCursor(e),e>=0&&this.flipDelimiter(t)},i.Scanner.prototype.extractNextToken=function(t,e){void 0===e||e===-1?this.nextToken=t:this.nextToken=t.slice(0,e)},i.Scanner.prototype.addToken=function(){this.delimiterIndex>0?this.orchestrateDisassemblies():this.addText()},i.Scanner.prototype.advanceCursor=function(t){t>=0?this.cursor=this.cursor+i.delimiters[this.delimiterIndex].length+t:this.cursor=this.outOfRange},i.Scanner.prototype.addText=function(){this.disassembly().addText(this.nextToken)},i.Scanner.prototype.orchestrateDisassemblies=function(){var t=new i.Tag(this.nextToken),e=this.disassembly();2===t.type||3===t.type?this.startSection(t):4===t.type&&t.name===e.key?this.endSection():e.addTag(t)},i.Scanner.prototype.startSection=function(t){var e=new i.Disassembly(t.name);e.addTag(t),this.disassemblies.push(e)},i.Scanner.prototype.endSection=function(){var t=this.disassemblies.pop(),e=t.tags[0];t.tags=t.tags.slice(1),e.disassembly=t,this.disassembly().addTag(e)},i.Scanner.prototype.disassembly=function(){return this.disassemblies[this.disassemblies.length-1]},i.Scanner.prototype.delimiter=function(){return i.delimiters[this.delimiterIndex]},i.Scanner.prototype.flipDelimiter=function(t){2===this.delimiterIndex||1===this.delimiterIndex?this.delimiterIndex=0:this.delimiterIndex=1,1===this.delimiterIndex&&""===this.nextToken&&"{"===t[2]&&(this.delimiterIndex=2)},i.Scanner.prototype.render=function(t,e){this.compile(),t=t||{},e=e||{};var i,s=[],n=this.disassemblies.length;for(i=0;i<n;i++)s.push(this.disassemblies[i].render(t,e));return String.prototype.concat.apply("",s)},i.Disassembly=function(t){this.key=t,this.texts=[],this.tags=[]},i.Disassembly.prototype.addText=function(t){t.length&&this.texts.push(t)},i.Disassembly.prototype.addTag=function(t){t.index=this.texts.length,this.tags.push(t),this.texts.push("")},i.Disassembly.prototype.render=function(t,e){var i,s=this.texts.slice(0),n=this.tags.length;for(i=0;i<n;i++)this.substitute(s,this.tags[i],t,e);return String.prototype.concat.apply("",s)},i.Disassembly.prototype.substitute=function(t,e,i,s){t[e.index]=e.render(i,s)},i.Variable=function(t,e){this.key=t,this.view=e,this.value=e[t],"."===t&&(this.value=e)},i.Variable.prototype.evaluate=function(){return this.isComplexKey()&&this.nestedValue(),this.stripFalseyValues(),this.value},i.Variable.prototype.isComplexKey=function(){if("."===this.key)return!1;var t=this.key.split(".");return this.complexKey=t,!!(t.length-1)},i.Variable.prototype.nestedValue=function(){var t,e=this.complexKey.length,i=this.view;for(t=0;t<e;t++)i&&(i=i[this.complexKey[t]]);this.value=i},i.Variable.prototype.stripFalseyValues=function(){this.value||0===this.value||(this.value="")},i.Tag=function(t,e){this.index=e,this.name=t.replace(/\s/g,""),this.separateTypeFromName()},i.Tag.prototype.separateTypeFromName=function(){this.type=this.determineType(),6!==this.type&&(this.name=this.name.slice(1))},i.Tag.prototype.determineType=function(){return{">":1,"#":2,"^":3,"/":4,"{":5}[this.name[0]]||6},i.Tag.prototype.render=function(t,e){var i;return i=1===this.type?this.partial(t,e):2===this.type?this.section(t,e):3===this.type?this.antiSection(t,e):5===this.type?this.evaluation(t):this.escapedEvaluation(t)},i.Tag.prototype.evaluation=function(t){return e(this.name,t)},i.Tag.prototype.escapedEvaluation=function(t){var i=e(this.name,t);return this.escape(i)},i.Tag.prototype.partial=function(t,e){var s,n=e[this.name];return n&&(s=i.render(n,t,e)),s||""},i.Tag.prototype.sectionView=function(t,e){var i=this.evaluation(t,e);return!(Array.isArray(i)&&!i.length)&&i},i.Tag.prototype.section=function(t,e){var i=this.sectionView(t,e);if(!i)return"";var s;return s=Array.isArray(i)?this.renderArraySection(i,e):this.disassembly.render(i,e)},i.Tag.prototype.renderArraySection=function(t,e){var i,s=[],n=t.length;for(i=0;i<n;i++)s.push(this.disassembly.render(t[i],e));return String.prototype.concat.apply("",s)},i.Tag.prototype.antiSection=function(t,e){var i=this.sectionView(t,e);return i?"":this.disassembly.render(t,e)},i.Tag.prototype.escape=function(t){return t.toString&&(t=t.toString()),String(t).replace(i.Tag.escapeRegex,i.Tag.escape)},i.Tag.escapeRegex=/[&<>"'`=\/]/g,i.Tag.escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},i.Tag.escape=function(t){return i.Tag.escapeMap[t]},t.Mario=i}(this),function(t){"use strict";var e={};e.polyfills={},e.utils={},e.polyfills.arrayForEach=function(t){var e,i,s=this.length;for(e=0;e<s;e++)i=this[e],t(i,e,this)},Array.prototype.forEach=Array.prototype.forEach||e.polyfills.arrayForEach,e.polyfills.arrayFind=function(t){var e,i,s,n=this.length;for(e=0;e<n;e++)if(i=this[e],s=t(i,e,this))return i},Array.prototype.find=Array.prototype.find||e.polyfills.arrayFind,e.polyfills.objectAssign=function(){var t,e,i,s=arguments[0];for(i=1;i<arguments.length;i++){t=arguments[i];for(e in t)t.hasOwnProperty(e)&&(s[e]=t[e])}return s},Object.assign=Object.assign||e.polyfills.objectAssign,e.utils.functionBind=function(t){var e=this;return function(){return e.apply(t,arguments)}},Function.prototype.bind=Function.prototype.bind||e.utils.functionBind,e.utils.typeOf=function(t){var e=Object.prototype.toString.call(t),i=e.match(/\[object (.*)\]/);return i&&i[1]},["String","Array","Object","Date","RegExp","Number","Function","Null","Undefined","Boolean"].forEach(function(t){e.utils["is"+t]=function(i){return e.utils.typeOf(i)===t}}),e.utils.isNil=function(t){return e.utils.isUndefined(t)||e.utils.isNull(t)},e.utils.camelize=function(t){return t.replace(/([_\-]\w)/g,function(t){return t[1].toUpperCase()})},e.utils.capitalize=function(t){return t.replace(/^[a-z]/,function(t){return t.toUpperCase()})},e.utils.classify=function(t){return e.utils.capitalize(e.utils.camelize(t))},e.createConstructor=function(){var t=function t(){if(!(this instanceof t))throw new Error("This is a class, and cannot be called without the new keyword.");this.__initialize.apply(this,arguments)};return t},e.BaseClass=e.createConstructor(),e.BaseClass.prototype.__initialize=function(){this._initialize.apply(this,arguments),this.initialize.apply(this,arguments)},e.BaseClass.prototype._initialize=function(){},e.BaseClass.prototype.initialize=function(){},e.BaseClass.extend=function t(i){var s=this,n=e.createConstructor(),r={};return r=e.BaseClass.mixProto(r,s.prototype),r=e.BaseClass.mixProto(r,i),n.prototype=r,n.prototype.contstructor=n,n.prototype.klass=n,n.extend=t,n},e.BaseClass.mixProto=function(t,e){var i,s=Object.assign({},t);for(var i in e)i.match(/prototype|__proto__|superclass|constructor/)||(s[i]=e[i]);return s},e.Config=e.BaseClass.extend({_initialize:function(t,e,i){this.defaultConfig=e,this.config=t,this.app=i,this.appClass=i.klass},get:function(t){if(void 0!==this["_"+t])return this["_"+t];var e;return e=void 0!==this.config[t]?this.config[t]:this.defaultConfig[t],this["_"+t]=e,e},getFromApp:function(t){var i=this.get("name");if(!this.appClass||!i)return this.defaultConfig[t];var s=this.appCollection(t),n=s[i]||s[e.utils.classify(i)];return void 0===n&&(n=this.defaultConfig[t]),n},appCollection:function(t){var i=t+"s";return i=e.utils.capitalize(i),this.appClass[i]||{}}}),e.ViewModel=e.BaseClass.extend({_initialize:function(t){t=t||{};var e=t.app||{};this.data=e.data&&e.data()},json:function(){return new e.ViewModel.ExtractJSON(this).run()}}),e.ViewModel.ExtractJSON=e.BaseClass.extend({_initialize:function(t){this.json={},this.viewModel=t,this.data=t.data,this.attributes=t.attributes||[],this.unescapedAttributes=t.unescapedAttributes||[]},run:function(){return this.addAttributes(),this.json},addAttributes:function(){this.attributes.forEach(function(t){this.json[t]=this.valueFor(t)}.bind(this))},valueFor:function(t){var i=e.utils.camelize(t),s=this.viewModel[t]||this.viewModel[i];return void 0!==s&&e.utils.isFunction(s)&&(s=s()),s||this.data[t]}}),e.View=e.BaseClass.extend({_initialize:function(t){t=t||{},this.app=t.app,this._config=new e.Config(this.config,e.View.defaultConfig,this.app),this.dom=this.findDom(t)||document.createElement("div")},render:function(){var t=this.renderVia(),e=this.renderTemplate();"append"===t?this.dom.innerHTML+=e:"replace"===t?this.dom.innerHTML=e:this.dom.innerHTML=e+this.dom.innerHTML},findDom:function(t){return new e.View.DomFinder(this.app,t.parent,this.selector()).dom()},renderTemplate:function(){return Mario.render(this.template(),this.viewModel())},template:function(){return this._config.getFromApp("template")},viewModel:function(){var t=this.viewModelClass();return new t({app:this.app}).json()},viewModelClass:function(){return this._config.getFromApp("viewModel")},selector:function(){return this._config.get("selector")},renderVia:function(){return this._config.get("renderVia")}}),e.View.name="View",e.View.defaultConfig={viewModel:function(){return{json:function(){return{}}}},template:"Template not found!",renderVia:"append",selector:void 0},e.View.DomFinder=e.BaseClass.extend({_initialize:function(t,e,i){this.app=t,this.parentDom=e,this.selector=i},parent:function(){return this.parentDom||this.app.dom},dom:function(){var t=this.parent();if(!this.selector)return t;var e=t.querySelector(this.selector);return e||t}}),e.App=e.BaseClass.extend({_initialize:function(){this.dom=document.querySelector(this.selector),this.events=new e.Events,this.router=new this.klass.Router(this,this.events)},start:function(){this.router.start()},selector:".application-container"}),e.App.Views={},e.App.ViewModels={},e.App.Templates={},e.App.extend=function(t){var i=e.BaseClass.extend.call(this,t);return i.Views={},i.ViewModels={},i.Templates={},i},e.Events=e.BaseClass.extend({__initialize:function(){this.callbacks={}},on:function(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),e},trigger:function(){var t=Array.prototype.slice.call(arguments),e=t[0],i=this.callbacks[e]||[];i.forEach(function(e){e.apply(e,t)})}}),e.Route=e.BaseClass.extend({initialize:function(t,e,i){this.app=t,this.Views=t.klass.Views,this.matcher=e,this.viewName=i,this.paramNames=[],this.disassembleMatchers()},disassembleMatchers:function(){var t=this.matcher;1===t.split(":").length&&1===t.split("*").length?this.isSimple=!0:this.matcherRegex=this.convertMatcher()},namedParam:/(\(\?)?:\w+/g,splatParam:/\*\w+/g,convertMatcher:function(){var t=/[\-{}\[\]+?.,\\\^$|#\s]/g,e=this,i=this.matcher.replace(t,"\\$&").replace(this.namedParam,function(t){return e.paramNames.push(t.slice(1)),"([^/?]+)"}).replace(this.splatParam,function(t){return e.paramNames.push(t.slice(1)),"([^?]*?)"});return new RegExp("^"+i+"(?:\\?([\\s\\S]*))?$")},match:function(t){return this.isSimple?t===this.matcher:this.matcherRegex.test(t)},ViewClass:function(){if(this._ViewClass)return this._ViewClass;var t,e,i,s=this.Views;for(t in s)if(e=s[t].prototype.config||{},e.name===this.viewName)return i=s[t],this._ViewClass=i,i},render:function(t){var e=this.ViewClass();if(e){var i=this.extractParams(t),s=new e({app:this.app,params:i});s.render()}},extractParams:function(t){var e={route:t};if(this.isSimple)return e;var i=this,s=this.matcherRegex.exec(t).slice(1);return s.forEach(function(t,s){t&&(e[i.paramNames[s]]=t)}),e}}),e.Router=e.BaseClass.extend({_initialize:function(t,e){this.events=e,this.app=t},start:function(){this.routeSet=new e.Router.LoadRoutes(this.app,this.routes).run(),this.listenForUrlChanges(),this.events.on("data:route",this.route.bind(this)),this.onStart()},listenForUrlChanges:function(){throw new Error("implement me: listenForUrlChanges in Router")},onStart:function(){var t=window.location.hash.slice(1)||"welcome";this.events.trigger("data:route",t)},route:function(t,e){if(this.routeSet){var i=this.routeSet.find(function(t){return t.match(e)});i&&i.render()}}}),e.Router.LoadRoutes=e.BaseClass.extend({initialize:function(t,e){this.app=t,this.routeMap=e,this.set=[]},run:function(){var t,e=this.routeMap;for(t in e)this.addRoute(t);return this.set},addRoute:function(t){var i=this.routeMap[t],s=new e.Route(this.app,t,i);this.set.push(s)}}),e.DomRebroadcaster=e.BaseClass.extend({_initialize:function(t,e){this.events=t,this.dom=e,this.listener=this.rebroadcast.bind(this),this.dom.addEventListener(this.domEventName,this.listener)},rebroadcast:function(){throw new Error('Implement me, and also "domEventName" and "republishEventName"')},publish:function(){this.events.trigger.apply(this.events,arguments)}}),e.DomRebroadcaster.HashChange=e.DomRebroadcaster.extend({domEventName:"hashchange",republishEventName:"data:route",rebroadcast:function(){var t=window.location.hash;this.publish(this.republishEventName,t.slice(1))}}),t.Blush=e}(this);
//# sourceMappingURL=blush-0.1.11.min.js.map
