{"version":3,"sources":["blush-0.1.11.min.js"],"names":["global","evaluate","key","view","isComplex","value","keys","split","length","i","temp","Mario","render","template","partials","scanner","this","compile","cache","Scanner","delimiters","disassemblies","Disassembly","cursor","delimiterIndex","compiled","outOfRange","prototype","processToken","tail","slice","nextTagLocation","indexOf","extractNextToken","addToken","advanceCursor","flipDelimiter","location","undefined","nextToken","orchestrateDisassemblies","addText","disassembly","tag","Tag","currentDisassembly","type","startSection","name","endSection","addTag","push","pop","baseTag","tags","delimiter","content","String","concat","apply","texts","text","index","tagLength","substitute","Variable","isComplexKey","nestedValue","stripFalseyValues","complexKey","replace","separateTypeFromName","determineType",">","#","^","/","{","rendered","partial","section","antiSection","evaluation","escapedEvaluation","escape","rendeded","sectionView","fullView","Array","isArray","renderArraySection","toString","escapeRegex","escapeMap","&","<","\"","'","`","=","Blush","polyfills","utils","arrayForEach","iterator","element","forEach","arrayFind","find","objectAssign","current","argumentIndex","target","arguments","hasOwnProperty","Object","assign","functionBind","context","func","Function","bind","typeOf","output","call","matches","match","isNil","isUndefined","isNull","camelize","word","g","toUpperCase","capitalize","c","classify","createConstructor","klass","Error","__initialize","BaseClass","_initialize","initialize","extend","attrs","ParentClass","ChildClass","proto","mixProto","contstructor","origProto","attr","Config","config","defaultConfig","app","appClass","get","getFromApp","collection","appCollection","collectionName","ViewModel","opts","data","json","ExtractJSON","run","viewModel","attributes","unescapedAttributes","addAttributes","valueFor","camelName","local","isFunction","View","_config","dom","findDom","document","createElement","renderVia","renderTemplate","innerHTML","DomFinder","parent","selector","viewModelClass","parentDom","found","querySelector","App","events","Events","router","Router","start","Views","ViewModels","Templates","callbacks","on","eventName","callback","trigger","args","Route","matcher","viewName","paramNames","disassembleMatchers","isSimple","matcherRegex","convertMatcher","namedParam","splatParam","escapeRegExp","self","route","RegExp","test","ViewClass","_ViewClass","viewClassName","params","extractParams","values","exec","routeSet","LoadRoutes","routes","listenForUrlChanges","onStart","startingRoute","window","hash","foundRoute","routeMap","set","addRoute","DomRebroadcaster","listener","rebroadcast","addEventListener","domEventName","publish","HashChange","republishEventName"],"mappings":"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","file":"blush-0.1.11.min.js","sourcesContent":["(function(global) {\n    'use strict';\n    var Mario = {\n        render: function(template, view, partials) {\n            var scanner = this.compile(template);\n            return scanner.render(view, partials);\n        },\n\n        compile: function(template) {\n            var scanner = this.cache[template];\n            if (!scanner) {\n                scanner = new Mario.Scanner(template);\n                this.cache[template] = scanner;\n            }\n            scanner.compile();\n            return scanner;\n        },\n\n        delimiters: ['{{', '}}', '}}}'],\n        cache: {}\n    };\n\n    Mario.Scanner = function(template) {\n        this.template = template;\n        this.disassemblies = [new Mario.Disassembly()];\n\n        this.cursor = 0;\n        this.delimiterIndex = 0;\n        this.compiled = false;\n        this.outOfRange = this.template.length + 1;\n    };\n\n    Mario.Scanner.prototype.compile = function compile() {\n        if (this.compiled) {\n            return;\n        }\n\n        var length = this.outOfRange - 1;\n        while (this.cursor < length) {\n            this.processToken();\n        }\n\n        this.compiled = true;\n    };\n\n    Mario.Scanner.prototype.processToken = function processToken() {\n        var tail = this.template.slice(this.cursor);\n        var nextTagLocation = tail.indexOf(Mario.delimiters[this.delimiterIndex]);\n\n        this.extractNextToken(tail, nextTagLocation);\n        this.addToken();\n        this.advanceCursor(nextTagLocation);\n\n        if (nextTagLocation >= 0) {\n            this.flipDelimiter(tail);\n        }\n    };\n\n    Mario.Scanner.prototype.extractNextToken = function extractNextToken(tail, location) {\n        if (location === undefined || location === -1) {\n            this.nextToken = tail;\n        } else {\n            this.nextToken = tail.slice(0, location);\n        }\n    };\n\n    Mario.Scanner.prototype.addToken = function addToken() {\n        if (this.delimiterIndex > 0) { // start of tag found, seeking ending\n            this.orchestrateDisassemblies();\n        } else {\n            this.addText();\n        }\n    };\n\n    Mario.Scanner.prototype.advanceCursor = function advanceCursor(nextTagLocation) {\n        if (nextTagLocation >= 0) {\n            this.cursor = this.cursor + Mario.delimiters[this.delimiterIndex].length + nextTagLocation;\n        } else {\n            this.cursor = this.outOfRange;\n        }\n    };\n\n    Mario.Scanner.prototype.addText = function() {\n        this.disassembly().addText(this.nextToken);\n    };\n\n    Mario.Scanner.prototype.orchestrateDisassemblies = function orchestrateDisassemblies() {\n        var tag = new Mario.Tag(this.nextToken);\n        var currentDisassembly = this.disassembly();\n        if (tag.type === 2 || tag.type === 3) {\n            this.startSection(tag);\n        } else if (tag.type === 4 && tag.name === currentDisassembly.key) {\n            this.endSection();\n        } else {\n            currentDisassembly.addTag(tag);\n        }\n    };\n\n    Mario.Scanner.prototype.startSection = function startSection(tag) {\n        var disassembly = new Mario.Disassembly(tag.name);\n        disassembly.addTag(tag);\n        this.disassemblies.push(disassembly);\n    };\n\n    Mario.Scanner.prototype.endSection = function endSection() {\n        var disassembly = this.disassemblies.pop();\n        var baseTag = disassembly.tags[0];\n        disassembly.tags = disassembly.tags.slice(1);\n        baseTag.disassembly = disassembly;\n        this.disassembly().addTag(baseTag);\n    };\n\n    Mario.Scanner.prototype.disassembly = function disassembly() {\n        return this.disassemblies[this.disassemblies.length - 1];\n    };\n\n    Mario.Scanner.prototype.delimiter = function delimiter() {\n        return Mario.delimiters[this.delimiterIndex];\n    };\n\n    Mario.Scanner.prototype.flipDelimiter = function flipDelimiter(tail) {\n        if (this.delimiterIndex === 2 || this.delimiterIndex === 1) {\n            this.delimiterIndex = 0;\n        } else {\n            this.delimiterIndex = 1;\n        }\n\n        if (this.delimiterIndex === 1 && this.nextToken === '' && tail[2] === '{') {\n            this.delimiterIndex = 2;\n        }\n    };\n\n    Mario.Scanner.prototype.render = function render(view, partials) {\n        this.compile();\n        view = view || {};\n        partials = partials || {};\n        var content = [];\n        var length = this.disassemblies.length;\n        var i;\n        for (i = 0; i < length; i++) {\n            content.push(this.disassemblies[i].render(view, partials));\n        }\n        return String.prototype.concat.apply('', content);\n    };\n\n    Mario.Disassembly = function(key) {\n        this.key = key;\n        this.texts = [];\n        this.tags = [];\n    };\n\n    Mario.Disassembly.prototype.addText = function addText(text) {\n        if (text.length) {\n            this.texts.push(text);\n        }\n    };\n\n    Mario.Disassembly.prototype.addTag = function addTag(tag) {\n        tag.index = this.texts.length;\n        this.tags.push(tag);\n        this.texts.push('');\n    };\n\n    Mario.Disassembly.prototype.render = function renderDisassembly(view, partials) {\n        var content = this.texts.slice(0);\n        var tagLength = this.tags.length;\n        var i;\n        for (i = 0; i < tagLength; i++) {\n            this.substitute(content, this.tags[i], view, partials);\n        }\n        return String.prototype.concat.apply('', content);\n    };\n\n    Mario.Disassembly.prototype.substitute = function substituteTagContent(content, tag, view, partials) {\n        content[tag.index] = tag.render(view, partials);\n    };\n\n    Mario.Variable = function(key, view) {\n        this.key = key;\n        this.view = view;\n        this.value = view[key];\n        if (key === '.') {\n            this.value = view;\n        }\n    };\n\n    Mario.Variable.prototype.evaluate = function evaluate() {\n        if (this.isComplexKey()) {\n            this.nestedValue();\n        }\n        this.stripFalseyValues();\n        return this.value;\n    };\n\n    Mario.Variable.prototype.isComplexKey = function isComplexKey() {\n        if (this.key === '.') {\n            return false;\n        }\n        var keys = this.key.split('.');\n        this.complexKey = keys;\n        return keys.length - 1 ? true : false;\n    };\n\n    Mario.Variable.prototype.nestedValue = function nestedValue() {\n        var length = this.complexKey.length;\n        var i;\n        var temp = this.view;\n        for (i = 0; i < length; i++) {\n            if (temp) {\n                temp = temp[this.complexKey[i]];\n            }\n        }\n        this.value = temp;\n    };\n\n    Mario.Variable.prototype.stripFalseyValues = function stripFalseyValues() {\n        if (!this.value && this.value !== 0) {\n            this.value = '';\n        }\n    };\n\n    function evaluate(key, view) {\n        var value = view[key];\n        var isComplex;\n        var keys = [];\n\n        if (key === '.') {\n            value = view;\n            isComplex = false;\n        } else {\n            keys = key.split('.');\n            isComplex = keys.length - 1 ? true : false;\n        }\n\n        if (isComplex) {\n            var length = keys.length;\n            var i;\n            var temp = view;\n            for (i = 0; i < length; i++) {\n                if (temp) {\n                    temp = temp[keys[i]];\n                }\n            }\n            value = temp;\n        }\n\n        if (!value && value !== 0) {\n            value = '';\n        }\n        return value;\n    }\n\n    Mario.Tag = function(name, index) {\n        this.index = index;\n        this.name = name.replace(/\\s/g, '');\n        this.separateTypeFromName();\n    };\n\n    Mario.Tag.prototype.separateTypeFromName = function separateTypeFromName() {\n        this.type = this.determineType();\n        if (this.type !== 6) {\n            this.name = this.name.slice(1);\n        }\n    };\n\n    Mario.Tag.prototype.determineType = function determineType() {\n        return {\n            '>': 1,\n            '#': 2,\n            '^': 3,\n            '/': 4,\n            '{': 5\n        }[this.name[0]] || 6;\n    };\n\n    Mario.Tag.prototype.render = function renderTag(view, partials) {\n        var rendered;\n        if (this.type === 1) {\n            rendered = this.partial(view, partials);\n        } else if (this.type === 2) {\n            rendered = this.section(view, partials);\n        } else if (this.type === 3) {\n            rendered = this.antiSection(view, partials);\n        } else if (this.type === 5) {\n            rendered = this.evaluation(view);\n        } else {\n            rendered = this.escapedEvaluation(view);\n        }\n        return rendered;\n    };\n\n    Mario.Tag.prototype.evaluation = function evaluation(view) {\n        //return new Mario.Variable(this.name, view).evaluate();\n        return evaluate(this.name, view);\n    };\n\n    Mario.Tag.prototype.escapedEvaluation = function escapedEvaluation(view) {\n        //var value = new Mario.Variable(this.name, view).evaluate();\n        var value = evaluate(this.name, view);\n        return this.escape(value);\n    };\n\n    Mario.Tag.prototype.partial = function renderPartial(view, partials) {\n        var partial = partials[this.name];\n        var rendeded;\n        if (partial) {\n            rendeded = Mario.render(partial, view, partials);\n        }\n        return rendeded || '';\n    };\n\n    Mario.Tag.prototype.sectionView = function sectionView(fullView, partials) {\n        var view = this.evaluation(fullView, partials);\n        if (Array.isArray(view) && !view.length) {\n            return false;\n        }\n        return view;\n    };\n\n    Mario.Tag.prototype.section = function renderSection(fullView, partials) {\n        var view = this.sectionView(fullView, partials);\n        if (!view) {\n            return '';\n        }\n        var content;\n        if (Array.isArray(view)) {\n            content = this.renderArraySection(view, partials);\n        } else {\n            content = this.disassembly.render(view, partials);\n        }\n        return content;\n    };\n\n    Mario.Tag.prototype.renderArraySection = function renderArraySection(view, partials) {\n        var content = [];\n        var length = view.length;\n        var i;\n        for (i = 0; i < length; i++) {\n            content.push(this.disassembly.render(view[i], partials));\n        }\n        return String.prototype.concat.apply('', content);\n    };\n\n    Mario.Tag.prototype.antiSection = function renderAntiSection(fullView, partials) {\n        var view = this.sectionView(fullView, partials);\n        if (view) {\n            return '';\n        }\n        return this.disassembly.render(fullView, partials);\n    };\n\n    // Stolen mostly from Mustache.js!\n    Mario.Tag.prototype.escape = function escapeHTML(value) {\n        if (value.toString) {\n            value = value.toString();\n        }\n\n        return String(value).replace(Mario.Tag.escapeRegex, Mario.Tag.escape);\n    };\n\n    Mario.Tag.escapeRegex = /[&<>\"'`=\\/]/g;\n    Mario.Tag.escapeMap = {\n        '&': '&amp;',\n        '<': '&lt;',\n        '>': '&gt;',\n        '\"': '&quot;',\n        '\\'': '&#39;',\n        '/': '&#x2F;',\n        '`': '&#x60;',\n        '=': '&#x3D;'\n    };\n    Mario.Tag.escape = function escape(value) {\n        return Mario.Tag.escapeMap[value];\n    };\n\n    global.Mario = Mario;\n})(this);\n(function(global) {\n    'use strict';\n    var Blush = {};\n    Blush.polyfills = {};\n    Blush.utils = {};\n\n    Blush.polyfills.arrayForEach = function arrayForEach(iterator) {\n        var length = this.length;\n        var i, element;\n        for (i = 0; i < length; i++) {\n            element = this[i];\n            iterator(element, i, this);\n        }\n    };\n\n    Array.prototype.forEach = Array.prototype.forEach || Blush.polyfills.arrayForEach;\n\n    Blush.polyfills.arrayFind = function arrayFind(iterator) {\n        var length = this.length;\n        var i, element, value;\n\n        for (i = 0; i < length; i++) {\n            element = this[i];\n            value = iterator(element, i, this);\n            if (value) {\n                return element;\n            }\n        }\n    };\n\n    Array.prototype.find = Array.prototype.find || Blush.polyfills.arrayFind;\n\n    Blush.polyfills.objectAssign = function() {\n        var target = arguments[0];\n        var current, key, argumentIndex;\n\n        for (argumentIndex = 1; argumentIndex < arguments.length; argumentIndex++) {\n            current = arguments[argumentIndex];\n            for (key in current) {\n                if (current.hasOwnProperty(key)) {\n                    target[key] = current[key];\n                }\n            }\n        }\n\n        return target;\n    };\n\n    Object.assign = Object.assign || Blush.polyfills.objectAssign;\n\n    Blush.utils.functionBind = function functionBind(context) {\n        var func = this;\n        return function() {\n            return func.apply(context, arguments);\n        };\n    };\n\n    Function.prototype.bind = Function.prototype.bind || Blush.utils.functionBind;\n\n    Blush.utils.typeOf = function typeOf(value) {\n        var output = Object.prototype.toString.call(value);\n        var matches = output.match(/\\[object (.*)\\]/);\n        return matches && matches[1];\n    };\n\n    ['String', 'Array', 'Object', 'Date', 'RegExp', 'Number', 'Function', 'Null', 'Undefined', 'Boolean'].forEach(function(type) {\n        Blush.utils['is' + type] = function isA(value) {\n            return Blush.utils.typeOf(value) === type;\n        };\n    });\n\n    Blush.utils.isNil = function isNil(value) {\n        return Blush.utils.isUndefined(value) || Blush.utils.isNull(value);\n    };\n\n    Blush.utils.camelize = function camelize(word) {\n        return word.replace(/([_\\-]\\w)/g, function(g) {\n            return g[1].toUpperCase();\n        });\n    };\n\n    Blush.utils.capitalize = function capitalize(word) {\n        return word.replace(/^[a-z]/, function(c) {\n            return c.toUpperCase();\n        });\n    };\n\n    Blush.utils.classify = function classify(word) {\n        return Blush.utils.capitalize(Blush.utils.camelize(word));\n    };\n\n    Blush.createConstructor = function() {\n        var klass = function klass() {\n            if (!(this instanceof klass)) {\n                throw new Error('This is a class, and cannot be called without the new keyword.');\n            }\n            this.__initialize.apply(this, arguments);\n        };\n        return klass;\n    };\n\n    Blush.BaseClass = Blush.createConstructor();\n\n    Blush.BaseClass.prototype.__initialize = function() {\n        this._initialize.apply(this, arguments);\n        this.initialize.apply(this, arguments);\n    };\n\n    Blush.BaseClass.prototype._initialize = function() {};\n    Blush.BaseClass.prototype.initialize = function() {};\n\n    Blush.BaseClass.extend = function extend(attrs) {\n        var ParentClass = this;\n        var ChildClass = Blush.createConstructor();\n\n        var proto = {};\n        proto = Blush.BaseClass.mixProto(proto, ParentClass.prototype);\n        proto = Blush.BaseClass.mixProto(proto, attrs);\n\n        ChildClass.prototype = proto;\n        ChildClass.prototype.contstructor = ChildClass;\n        ChildClass.prototype.klass = ChildClass;\n        ChildClass.extend = extend;\n\n        return ChildClass;\n    };\n\n    Blush.BaseClass.mixProto = function mixProto(origProto, attrs) {\n        var proto = Object.assign({}, origProto);\n        var attr;\n\n        for (var attr in attrs) {\n            if (attr.match(/prototype|__proto__|superclass|constructor/)) {\n                continue;\n            }\n            proto[attr] = attrs[attr];\n        }\n\n        return proto;\n    };\n\n    Blush.Config = Blush.BaseClass.extend({\n        _initialize: function(config, defaultConfig, app) {\n            this.defaultConfig = defaultConfig;\n            this.config = config;\n            this.app = app;\n            this.appClass = app.klass;\n        },\n\n        get: function(key) {\n            if (this['_' + key] !== undefined) {\n                return this['_' + key];\n            }\n\n            var value;\n            if (this.config[key] !== undefined) {\n                value = this.config[key];\n            } else {\n                value = this.defaultConfig[key];\n            }\n\n            this['_' + key] = value;\n            return value;\n        },\n\n        getFromApp: function(key) {\n            var name = this.get('name');\n            if (!this.appClass || !name) {\n                return this.defaultConfig[key];\n            }\n\n            var collection = this.appCollection(key);\n            var value = collection[name] || collection[Blush.utils.classify(name)];\n            if (value === undefined) {\n                value = this.defaultConfig[key];\n            }\n\n            return value;\n        },\n\n        appCollection: function(key) {\n            var collectionName = key + 's';\n            collectionName = Blush.utils.capitalize(collectionName);\n            return this.appClass[collectionName] || {};\n        }\n    });\n\n    Blush.ViewModel = Blush.BaseClass.extend({\n        _initialize: function(opts) {\n            opts = opts || {};\n            var app = opts.app || {};\n            this.data = app.data && app.data();\n        },\n\n        json: function() {\n            return new Blush.ViewModel.ExtractJSON(this).run();\n        }\n    });\n\n    Blush.ViewModel.ExtractJSON = Blush.BaseClass.extend({\n        _initialize: function(viewModel) {\n            this.json = {};\n            this.viewModel = viewModel;\n            this.data = viewModel.data;\n            this.attributes = viewModel.attributes || [];\n            this.unescapedAttributes = viewModel.unescapedAttributes || [];\n        },\n\n        run: function() {\n            this.addAttributes();\n            return this.json;\n        },\n\n        addAttributes: function() {\n            this.attributes.forEach(function(name) {\n                this.json[name] = this.valueFor(name);\n            }.bind(this));\n        },\n\n        valueFor: function(name) {\n            var camelName = Blush.utils.camelize(name);\n            var local = this.viewModel[name] || this.viewModel[camelName];\n            if (local !== undefined && Blush.utils.isFunction(local)) {\n                local = local();\n            }\n            return local || this.data[name];\n        }\n    });\n\n    Blush.View = Blush.BaseClass.extend({\n        _initialize: function(opts) {\n            opts = opts || {};\n            this.app = opts.app;\n            this._config = new Blush.Config(this.config, Blush.View.defaultConfig, this.app);\n            this.dom = this.findDom(opts) || document.createElement('div');\n        },\n\n        render: function() {\n            var renderVia = this.renderVia();\n            var rendered = this.renderTemplate();\n            // TODO: switch to more efficient if test \n            // View.attachmentType.APPEND = 0; // etc\n            if (renderVia === 'append') {\n                this.dom.innerHTML += rendered;\n            } else if (renderVia === 'replace') {\n                this.dom.innerHTML = rendered;\n            } else {\n                this.dom.innerHTML = rendered + this.dom.innerHTML;\n            }\n        },\n\n        findDom: function(opts) {\n            return new Blush.View.DomFinder(this.app, opts.parent, this.selector()).dom();\n        },\n\n        renderTemplate: function() {\n            return Mario.render(this.template(), this.viewModel());\n        },\n\n        template: function() {\n            return this._config.getFromApp('template');\n        },\n\n        viewModel: function() {\n            var viewModelClass = this.viewModelClass();\n            return new viewModelClass({\n                app: this.app\n            }).json();\n        },\n\n        viewModelClass: function() {\n            return this._config.getFromApp('viewModel');\n        },\n\n        selector: function() {\n            return this._config.get('selector');\n        },\n\n        renderVia: function() {\n            return this._config.get('renderVia');\n        }\n    });\n\n    Blush.View.name = 'View';\n\n    Blush.View.defaultConfig = {\n        viewModel: function() {\n            return {\n                json: function() {\n                    return {};\n                }\n            };\n        },\n        template: 'Template not found!',\n        renderVia: 'append', // prepend, or replace\n        selector: undefined\n    };\n\n\n    Blush.View.DomFinder = Blush.BaseClass.extend({\n        _initialize: function(app, parentDom, selector) {\n            this.app = app;\n            this.parentDom = parentDom;\n            this.selector = selector;\n        },\n\n        parent: function() {\n            return this.parentDom || this.app.dom;\n        },\n\n        dom: function() {\n            var parent = this.parent();\n            if (!this.selector) {\n                return parent;\n            }\n            var found = parent.querySelector(this.selector);\n            return found || parent;\n        }\n    });\n\n    Blush.App = Blush.BaseClass.extend({\n        _initialize: function() {\n            this.dom = document.querySelector(this.selector);\n            this.events = new Blush.Events();\n            this.router = new this.klass.Router(this, this.events);\n        },\n\n        start: function() {\n            this.router.start();\n        },\n\n        selector: '.application-container'\n    });\n\n    Blush.App.Views = {};\n    Blush.App.ViewModels = {};\n    Blush.App.Templates = {};\n\n    Blush.App.extend = function(attrs) {\n        var App = Blush.BaseClass.extend.call(this, attrs);\n        App.Views = {};\n        App.ViewModels = {};\n        App.Templates = {};\n        return App;\n    };\n\n    Blush.Events = Blush.BaseClass.extend({\n        __initialize: function() {\n            this.callbacks = {};\n        },\n\n        on: function(eventName, callback) {\n            this.callbacks[eventName] || (this.callbacks[eventName] = []);\n            this.callbacks[eventName].push(callback);\n            return callback;\n        },\n\n        trigger: function() {\n            var args = Array.prototype.slice.call(arguments);\n            var eventName = args[0];\n            var callbacks = this.callbacks[eventName] || [];\n            callbacks.forEach(function(callback) {\n                callback.apply(callback, args);\n            });\n        }\n    });\n\n    Blush.Route = Blush.BaseClass.extend({\n        initialize: function(app, matcher, viewName) {\n            this.app = app;\n            this.Views = app.klass.Views;\n            this.matcher = matcher;\n            this.viewName = viewName;\n            this.paramNames = [];\n            this.disassembleMatchers();\n        },\n\n        disassembleMatchers: function() {\n            var matcher = this.matcher;\n            if (matcher.split(':').length === 1 &&\n                matcher.split('*').length === 1) {\n                this.isSimple = true;\n            } else {\n                this.matcherRegex = this.convertMatcher();\n            }\n        },\n\n        namedParam: /(\\(\\?)?:\\w+/g,\n        splatParam: /\\*\\w+/g,\n\n        // NOTE from backbone, license MIT\n        convertMatcher: function() {\n            var escapeRegExp = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n            var self = this;\n            var route = this.matcher\n                .replace(escapeRegExp, '\\\\$&')\n                .replace(this.namedParam, function(key) {\n                    self.paramNames.push(key.slice(1));\n                    return '([^/?]+)';\n                })\n                .replace(this.splatParam, function(key) {\n                    self.paramNames.push(key.slice(1));\n                    return '([^?]*?)';\n                });\n            return new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$');\n        },\n\n        match: function(route) {\n            if (this.isSimple) {\n                return route === this.matcher;\n            }\n            return this.matcherRegex.test(route);\n        },\n\n        ViewClass: function() {\n            if (this._ViewClass) {\n                return this._ViewClass;\n            }\n\n            var Views = this.Views;\n            var viewClassName, config, ViewClass;\n\n            for (viewClassName in Views) {\n                config = Views[viewClassName].prototype.config || {};\n                if (config.name === this.viewName) {\n                    ViewClass = Views[viewClassName];\n                    this._ViewClass = ViewClass;\n                    return ViewClass;\n                }\n            }\n        },\n\n        render: function(route) {\n            var ViewClass = this.ViewClass();\n            if (!ViewClass) {\n                return;\n            }\n\n            var params = this.extractParams(route);\n            var view = new ViewClass({\n                app: this.app,\n                params: params\n            });\n            view.render();\n        },\n\n        extractParams: function(route) {\n            var params = {\n                route: route\n            };\n            if (this.isSimple) {\n                return params;\n            }\n\n            var self = this;\n            var values = this.matcherRegex.exec(route).slice(1);\n            values.forEach(function(value, i) {\n                if (!value) {\n                    return;\n                }\n                params[self.paramNames[i]] = value;\n            });\n\n            return params;\n        }\n    });\n\n    Blush.Router = Blush.BaseClass.extend({\n        _initialize: function(app, events) {\n            this.events = events;\n            this.app = app;\n        },\n\n        start: function() {\n            this.routeSet = new Blush.Router.LoadRoutes(this.app, this.routes).run();\n            this.listenForUrlChanges();\n            this.events.on('data:route', this.route.bind(this));\n            this.onStart();\n        },\n\n        listenForUrlChanges: function() {\n            throw new Error('implement me: listenForUrlChanges in Router');\n            //new Blush.DomRebroadcaster.HashChange(this.events, window);\n            //new Blush.DomRebroadcaster.PopStateChange(this.events, window);\n        },\n\n        onStart: function() {\n            // this should really be part of the data store, default state\n            // and route data should pull from data.route instead of finding it;\n            var startingRoute = window.location.hash.slice(1) || 'welcome';\n            this.events.trigger('data:route', startingRoute);\n            //this.events.trigger('data:route', this.data('route'));\n        },\n\n        route: function(eventName, matcher) {\n            if (!this.routeSet) {\n                return;\n            }\n\n            var foundRoute = this.routeSet.find(function(route) {\n                return route.match(matcher);\n            });\n\n            if (foundRoute) {\n                foundRoute.render();\n            }\n        }\n    });\n\n    Blush.Router.LoadRoutes = Blush.BaseClass.extend({\n        initialize: function(app, routeMap) {\n            this.app = app;\n            this.routeMap = routeMap;\n            this.set = [];\n        },\n\n        run: function() {\n            var matcher;\n            var routeMap = this.routeMap;\n            for (matcher in routeMap) {\n                this.addRoute(matcher);\n            }\n            return this.set;\n        },\n\n        addRoute: function(matcher) {\n            var viewName = this.routeMap[matcher];\n            var route = new Blush.Route(this.app, matcher, viewName);\n            this.set.push(route);\n        }\n    });\n\n    Blush.DomRebroadcaster = Blush.BaseClass.extend({\n        _initialize: function(events, dom) {\n            this.events = events;\n            this.dom = dom;\n            this.listener = this.rebroadcast.bind(this);\n            this.dom.addEventListener(this.domEventName, this.listener);\n        },\n\n        /*\n         * Subclasses must set attributes:\n         *    'domEventName'\n         *    'republishEventName'\n         */\n\n        rebroadcast: function() {\n            throw new Error('Implement me, and also \"domEventName\" and \"republishEventName\"');\n            // this.publish(this.republishEventName, SOME_DATA_HERE);\n        },\n\n        publish: function() {\n            this.events.trigger.apply(this.events, arguments);\n        }\n    });\n\n    Blush.DomRebroadcaster.HashChange = Blush.DomRebroadcaster.extend({\n        domEventName: 'hashchange',\n        republishEventName: 'data:route',\n\n        rebroadcast: function() {\n            var hash = window.location.hash;\n            this.publish(this.republishEventName, hash.slice(1));\n        }\n    });\n\n\n    global.Blush = Blush;\n})(this);"]}